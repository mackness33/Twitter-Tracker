<!DOCTYPE html>
<html>
  <head>
    <title>Twitter Tracker</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">

    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,400italic,700' rel='stylesheet' type='text/css'>

    <style type="text/css">

		p {
   			margin-top: 1vw;
		}
		h1 {
   			text-align: center;
   			margin-top: 1vw;
   			margin-bottom: 1vw;
		   	color: #50ABF1;
   			font-size: 3vw;
   			font-family: Helvetica;
		}
		#input, #input2, #button {
   			height: 3vw;
   			width: 50%;
   			margin-top: 1vw;
   			margin-left: 25%;
   			margin-right: 25%;
   			text-align: center;
   			font-size: large;
   			border-radius: 5px;
   			border-color: rgb(0, 174, 255);
   			font-family: Arial, Helvetica, serif;
		}
		#button {
		   	font-weight: bold;
   			background-color: blue;
   			color: orange;
		}
		#descrizione {
   			font-size: 0.6vw;
   			text-align: center;
		}

      	html, body {
        	margin: 0;
        	padding: 0;
        	height:100%;
        	font-family: open sans;
			width: 100%;
      	}

      	#container-map, #ricerca, #word_cloud, #visualizzazione_tw{
		  	width:50%;
		  	height:50%;
		  	position: relative;
		  	float: left;
		  	overflow: auto;
		}

      	#map-canvas{
			width: 95%;
			height:95%;
			position:relative;
			z-index:10;
		}

	  	iframe{
			width: 95%;
			height: 95%;
		}

	</style>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<!--libreria mappa-->
	<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>

	<!--librerie wordcloud-->
	<script src="https://cdn.amcharts.com/lib/4/core.js"></script>
	<script src="https://cdn.amcharts.com/lib/4/charts.js"></script>
	<script src="https://cdn.amcharts.com/lib/4/plugins/wordCloud.js"></script>
	<script src="https://cdn.amcharts.com/lib/4/themes/animated.js"></script>
	
	<script>

		/*gestione tweet raccolti*/
		function richiesta_dati(){
			$.ajax({
           	type: "POST",
           	url: "/base",
           	data: $("#foro").serialize(), // serializes the form's elements.
           	success: function(data)
           	{
			   	var dati = data.data;
			   	//var testo = dati[4].entities.hashtags[0].tag;
			   	var testo2 = ""
			   	for (a of dati){
					pk = 0;
					if (typeof a.entities!=="undefined"){
					   	if (typeof a.entities.hashtags!=="undefined"){
						   	while (typeof a.entities.hashtags[pk]!=="undefined"){
						   		testo2 = testo2 + " " + a.entities.hashtags[pk].tag;
								pk=pk+1;
							}
						}
					}
			   	}
			   	gibbolo(testo2);
			   	console.log(dati);// show response from the server.
			   	console.log(testo2);
           	}
         	});
		}

		/*mappa*/
		function initialize() {

			/* Style of the map */
			var styles = [
			{
		      stylers: [
		        { hue: "#00ffe6" },
		        { saturation: -20 }
		      ]
		    },{
		      featureType: "road",
		      elementType: "geometry",
		      stylers: [
		        { lightness: 100 },
		        { visibility: "simplified" }
		      ]
		    },{
		      featureType: "road",
		      elementType: "labels",
		      stylers: [
		        { visibility: "off" }
		      ]
		    },{
		         featureType: "poi",
		         elementType: "labels",
		         stylers: [
		           { visibility: "off" }
		         ]
		       }

		    ];


		  // Create a new StyledMapType object, passing it the array of styles,
		  // as well as the name to be displayed on the map type control.
		  var styledMap = new google.maps.StyledMapType(styles, {name: "Styled Map"});

		  /* Lat. and Lon. of the center of the map */
		  var myCenter = new google.maps.LatLng(44.302700, 11.21504);

		  // Create a map object, and include the MapTypeId to add
		  // to the map type control.
		  var mapOptions = {
		    zoom: 12, 				//zoom level
		    center: myCenter, 		//center position
		    scrollwheel: false, 	//zoom when scroll disable
		    zoomControl: true, 		//show control zoom

		    mapTypeControlOptions: {
		      mapTypeIds: [google.maps.MapTypeId.ROADMAP, 'map_style']
		    }

		  };

		  var map = new google.maps.Map(document.getElementById('map-canvas'),mapOptions);

		  //Associate the styled map with the MapTypeId and set it to display.
		  map.mapTypes.set('map_style', styledMap);
		  map.setMapTypeId('map_style');


		  gino=[[52.520196, 13.406067],[50.520196, 12.406067],[44.302700, 11.21504]];

		  for(a of gino){

		  var myLatlng = new google.maps.LatLng(a[0], a[1]);
		  var marker = new google.maps.Marker({
		      position: myLatlng,
		      map: map,
		  });
		  }
	}

	google.maps.event.addDomListener(window, 'load', initialize);

	//wordcloud

	// Chart code

	//am4core.ready(function() {

		function gibbolo(a){

		// Themes begin
		am4core.useTheme(am4themes_animated);
		// Themes end

		var chart = am4core.create("word_cloud", am4plugins_wordCloud.WordCloud);
		var series = chart.series.push(new am4plugins_wordCloud.WordCloudSeries());

		series.accuracy = 4;
		series.step = 15;
		series.rotationThreshold = 0.7;
		series.maxCount = 200;
		series.minWordLength = 2;
		series.labels.template.tooltipText = "{word}: {value}";
		series.fontFamily = "Courier New";
		series.maxFontSize = am4core.percent(30);

		series.text = a;

	};

	</script>
  </head>
	<body>
		<div id="ricerca">
	    	<h1>Twitter Tracker</h1>
    		<form id="foro" method="post" target="tweet">
				<input id="input" type="text" name="ricerca" ><br>
				<input id="input2" type="text" name="numero_tw" ><br>
				<input id="button" type="submit" onclick=richiesta_dati() value="Search" /> 
    		</form>
	    	<p id="descrizione">
    			Per cercare: <br>
        		-una parola chiave scrivi la parola preceduta dal carattere #, <br>
       			-una zona scrivi il nome della zona preceduta dal carattere $, <br>
       			-gli spostamenti di una persona scrivi il nome utente di quella persona (compresa la @). <br>
    		</p>
		</div>
		<div id="visualizzazione_tw">
			<iframe id="denis" name="tweet"></iframe>
		</div>
  		<div id="container-map">
    		<div id="map-canvas"></div>
	  	</div>
		<div id="word_cloud">
		</div>
  	</body>
</html>
